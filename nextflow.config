manifest {
    mainScript = 'phage.nf'
}

// default parameters
params {
  cores = "8"
  mem = "12"
  help = false
  fasta = ''
  fastq = ''
  dir = ''
  list = false
  cloudDatabase = false

  workDir = "/tmp/nextflow-phages-$USER"
  //on EBI LSF
  //workdir = "/hps/nobackup2/production/metagenomics/mhoelzer/nextflow-work-$USER"

  cacheDir = "/hps/nobackup2/singularity/mhoelzer"


  // folder structure
  output = 'results'
}


profiles {

  standard {
        params.cloudProcess = false
        params.cloudDatabase = false
        process.executor = 'local'
        docker { enabled = true }
        params.cpus = params.cores
        workDir = params.workDir
        process {
	          withLabel: virsorter { cpus = 1; container = 'multifractal/virsorter:latest' }
            withLabel: deepvirfinder { cpus = 1; container = 'multifractal/deepvirfinder:0.1' }
            withLabel: marvel { cpus = 1; container = 'multifractal/marvel:0.1' }
            withLabel: metaphinder { cpus = 1; container = ' multifractal/metaphinder:0.1' }
            withLabel: pprmeta { cpus = 1; container = 'multifractal/ppr-meta:0.1' }
            withLabel: r_plot { cpus = 1; container = 'replikation/r-phage-plot:latest' }
            withLabel: ubuntu { cpus = 1; container = 'ubuntu:bionic' }
            withLabel: virfinder { cpus = 1; container = 'multifractal/virfinder:0.1' }
} }

 lsf {
        params.cloudProcess = true
        //params.cloudDatabase = '/homes/mhoelzer/data/nextflow-databases/'
        workDir = params.workDir

        process.executor = 'lsf'
        singularity {
            enabled = true
            autoMounts = true
            cacheDir = params.cacheDir
        }
        params.cpus = params.cores

        process {
            cache = "lenient"
            //errorStrategy = "retry"
            //maxRetries = 1
            withLabel: virsorter { cpus = 8; memory = '8 GB'; container = 'multifractal/virsorter:latest' }
            withLabel: deepvirfinder { cpus = 8; memory = '8 GB'; container = 'multifractal/deepvirfinder:0.1' }
            withLabel: marvel { cpus = 8; memory = '8 GB'; container = 'multifractal/marvel:0.1' }
            withLabel: metaphinder { cpus = 8; memory = '8 GB'; container = 'multifractal/metaphinder:0.1' }
            withLabel: pprmeta { cpus = 8; memory = '8 GB'; container = 'multifractal/ppr-meta:0.1' }
            withLabel: r_plot { cpus = 4; memory = '4 GB'; container = 'replikation/r-phage-plot:latest' }
            withLabel: ubuntu { cpus = 4; memory = '4 GB'; container = 'ubuntu:bionic' }
            withLabel: virfinder { cpus = 8; memory = '8 GB'; container = 'multifractal/virfinder:0.1' }
            withLabel: noDocker { cpus = 1 ; memory = '8 GB' ; container = 'nanozoo/abricate:0.9.3--db720c5' }
} }

}
